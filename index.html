<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Stitch Betting Game</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;500;700;900&family=Space+Grotesk:wght@400;500;700&display=swap"
    />
    <style>
      body {
        font-family: "Space Grotesk", "Noto Sans", sans-serif;
      }

      input[type="range"] {
        -webkit-appearance: none;
        width: 100%;
        height: 6px;
        background: #2b3540;
        border-radius: 4px;
        outline: none;
      }

      input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        height: 20px;
        width: 20px;
        border-radius: 50%;
        background: #dce7f3;
        cursor: pointer;
        border: none;
        margin-top: -7px; /* Align with track */
      }

      input[type="range"]::-moz-range-thumb {
        height: 20px;
        width: 20px;
        border-radius: 50%;
        background: #dce7f3;
        cursor: pointer;
        border: none;
      }
    </style>
  </head>
  <body class="bg-[#14191f] min-h-screen text-white">
    <div class="flex flex-col justify-between min-h-screen relative">
      <!-- Header -->
      <div class="flex items-center bg-[#14191f] p-4 pb-2 justify-between">
        <div class="text-white flex size-12 items-center">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            fill="currentColor"
            viewBox="0 0 256 256"
          >
            <path
              d="M224,128a8,8,0,0,1-8,8H59.31l58.35,58.34a8,8,0,0,1-11.32,11.32l-72-72a8,8,0,0,1,0-11.32l72-72a8,8,0,0,1,11.32,11.32L59.31,120H216A8,8,0,0,1,224,128Z"
            ></path>
          </svg>
        </div>
        <h2 class="text-lg font-bold text-center flex-1 pr-12">Game #12345</h2>
      </div>

      <!-- Result -->
      <h1 id="result" class="text-white text-[96px] font-bold text-center py-6">
        ?
      </h1>

      <!-- History -->
      <div class="absolute top-36 right-0 px-4 w-16">
        <div id="history" class="flex flex-col items-center gap-3 py-4"></div>
      </div>

      <!-- User Control Panel -->
      <div>
        <div class="flex gap-6 w-full max-w-5xl items-end px-4">
          <label class="flex flex-col flex-1">
            <p class="text-base font-medium pb-2 truncate">Balance</p>
            <div
              id="balanceDisplay"
              class="text-white text-center rounded-xl h-14 flex items-center justify-center bg-[#2b3540]"
            >
              $100.00
            </div>
          </label>

          <label class="flex flex-col flex-1 relative">
            <p class="text-base font-medium pb-2">Bet Amount</p>
            <div
              class="flex items-center justify-center bg-[#2b3540] rounded-xl h-14"
              id="betWrapper"
            >
              <button
                onclick="adjustBet(-1)"
                class="w-10 h-full text-white text-xl"
              >
                -
              </button>
              <input
                id="betAmount"
                type="number"
                step="0.1"
                min="0.1"
                value="10"
                class="w-20 text-center bg-transparent outline-none text-white border-none ring-0 focus:ring-0 focus:outline-none"
              />

              <button
                onclick="adjustBet(1)"
                class="w-10 h-full text-white text-xl"
              >
                +
              </button>
            </div>
          </label>

          <label class="flex flex-col flex-1">
            <p class="text-base font-medium pb-2 truncate">Multiplier (x)</p>
            <div
              id="multiplierDisplay"
              class="text-white text-center rounded-xl h-14 flex items-center justify-center bg-[#2b3540]"
            >
              -
            </div>
          </label>
        </div>

        <!-- Slider -->
        <div class="@container">
          <div
            class="relative flex w-full flex-col items-start justify-between gap-3 p-4 @[480px]:flex-row @[480px]:items-center"
          >
            <div class="flex w-full items-center justify-between">
              <p class="text-base font-medium">Adjust Bet</p>
              <div
                class="text-white text-center mb-4 px-2"
                id="sidebarSliderValue"
              >
                Number: 50
              </div>
              <p class="text-sm hidden @[480px]:block" id="sliderValue">50</p>
            </div>
            <input
              id="slider"
              type="range"
              min="1"
              max="99"
              value="50"
              class="w-full"
              oninput="updateSliderValue(this.value)"
            />
          </div>
        </div>

        <!-- Condition Buttons -->
        <!-- Less and More Buttons -->
        <div class="flex flex-1 gap-4 flex-row px-4 py-3 justify-center">
          <button
            onclick="setCondition('less')"
            id="btnLess"
            class="min-w-[84px] w-full h-12 px-6 justify-center rounded-full bg-[#2b3540] text-white font-extrabold hover:bg-[#3a4753] transition-colors duration-200"
          >
            Less
          </button>
          <button
            onclick="setCondition('greater')"
            id="btnMore"
            class="min-w-[84px] w-full h-12 px-6 justify-center rounded-full bg-[#2b3540] text-white font-extrabold hover:bg-[#3a4753] transition-colors duration-200"
          >
            More
          </button>
        </div>

        <!-- Guess Button -->
        <div class="flex flex-1 px-4 py-3">
          <button
            id="btnGuess"
            onclick="guessNumber()"
            disabled
            class="w-full h-12 px-6 justify-center rounded-full bg-[#2b3540] text-white font-extrabold hover:bg-[#3a4753] transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            Guess
          </button>
        </div>

        <div class="h-5"></div>
      </div>
    </div>

    <script>
      const HOUSE_EDGE = 0.05;
      let balance = 100;
      let history = [];
      let condition = null;
      let sliderValue = 50;

      function updateBalanceDisplay() {
        document.getElementById(
          "balanceDisplay"
        ).textContent = `$${balance.toFixed(2)}`;
      }

      function getRandomNumber() {
        return Math.floor(Math.random() * 99) + 1;
      }

      function adjustBet(delta) {
        const input = document.getElementById("betAmount");
        let value = parseFloat(input.value) || 0;
        value = Math.max(0.1, value + delta * 0.1);
        value = Math.round(value * 10) / 10; // ensure 1 decimal precision
        input.value = value.toFixed(1);
      }

      function updateSliderValue(val) {
        sliderValue = Number(val);
        document.getElementById("sliderValue").innerText = val;
        document.getElementById(
          "sidebarSliderValue"
        ).innerText = `Number: ${val}`;
        updateMultiplier();
      }

      function setCondition(newCondition) {
        condition = newCondition;
        document.getElementById("btnLess").classList.remove("btn-selected");
        document.getElementById("btnMore").classList.remove("btn-selected");

        if (condition === "less") {
          document.getElementById("btnLess").classList.add("btn-selected");
        } else {
          document.getElementById("btnMore").classList.add("btn-selected");
        }

        updateMultiplier();
        document.getElementById("btnGuess").disabled = false;
      }

      function updateMultiplier() {
        if (!condition) {
          document.getElementById("multiplierDisplay").textContent = "-";
          return;
        }
        let chance = condition === "less" ? sliderValue : 100 - sliderValue;
        if (chance < 1) chance = 1;
        const rawMultiplier = 100 / chance;
        const adjusted = (rawMultiplier * (1 - HOUSE_EDGE)).toFixed(2);
        document.getElementById(
          "multiplierDisplay"
        ).textContent = `${adjusted}x`;
      }

      function showBetError() {
        document
          .getElementById("betWrapper")
          .classList.add("border", "border-red-500");
      }

      function hideBetError() {
        document
          .getElementById("betWrapper")
          .classList.remove("border", "border-red-500");
      }

      function guessNumber() {
        const betInput = document.getElementById("betAmount");
        let betAmount = parseFloat(betInput.value);
        if (isNaN(betAmount) || betAmount < 1) return;

        if (betAmount > balance) {
          betAmount = balance;
          betInput.value = balance;
          showBetError();
          return;
        }

        hideBetError();

        const result = getRandomNumber();
        const resultEl = document.getElementById("result");
        resultEl.textContent = "?";
        resultEl.classList.remove("text-green-500", "text-red-600");

        setTimeout(() => {
          resultEl.textContent = result;

          const win =
            (condition === "greater" && result > sliderValue) ||
            (condition === "less" && result < sliderValue);

          let chance = condition === "less" ? sliderValue : 100 - sliderValue;
          const multiplier = (100 / chance) * (1 - HOUSE_EDGE);

          if (win) {
            balance += betAmount * (multiplier - 1);
            resultEl.classList.add("text-green-500");
          } else {
            balance -= betAmount;
            resultEl.classList.add("text-red-600");
          }

          updateBalanceDisplay();
        }, 100);

        history.unshift(result);
        if (history.length > 7) history.pop();
        updateHistory();
      }

      function updateHistory() {
        const container = document.getElementById("history");
        container.innerHTML = "";
        const maxItems = 7;

        history.forEach((num, index) => {
          const div = document.createElement("div");
          div.className = "flex justify-center p-2 items-center";

          // Calculate progressive opacity for color
          const brightness = 1 - (index / maxItems) * 0.6; // from 1 to 0.4 opacity
          div.style.color = `rgba(255, 255, 255, ${brightness.toFixed(2)})`;

          // Bigger text for the first item
          if (index === 0) {
            div.innerHTML = `<h2 class="text-3xl font-extrabold leading-tight">${num}</h2>`;
          } else {
            div.innerHTML = `<h2 class="text-base font-bold leading-tight">${num}</h2>`;
          }

          container.appendChild(div);
        });
      }

      window.onload = () => {
        updateBalanceDisplay();
        updateSliderValue(sliderValue);
        updateMultiplier();
        document.getElementById("btnGuess").disabled = true;
      };
    </script>
  </body>
</html>
